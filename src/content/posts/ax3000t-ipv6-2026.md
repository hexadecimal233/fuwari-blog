---
title: OpenWRT旁路由IPV6解决方案【更新】
published: 2026-02-06
updated: 2026-02-07
description: 针对 OpenWRT 的旁路由 IPv6 配置方案，包含公网访问、防火墙配置、常见问题排查。
tags: [OpenWRT, AX3000T, IPv6, 路由器]
category: 网络
draft: false
---

## 前言

之前配置的 OpenWRT 重置配置过后就又连不上 IPV6 了，又看了一遍自己写的笔记发现能获取到 IPV6，但是 ping 任何网站都显示为超时...

之前折腾了好一会，最后还是问 <ruby>双子座<rp><rt>Gemini</rt></rp></ruby> (之前玩谷歌娘机翻看到的)

## 网络拓扑

```text
光猫 (192.168.1.1) [主路由，DHCPv4+DHCPv6下发]
       │
       │ WAN 口
       ▼
AX3000T OpenWRT (192.168.1.254 / 192.168.2.1) [旁路由]
       │
       │ LAN 口
       ▼
    客户端
```

## 网络配置

### WAN 口配置（获取 IPv4）

进入 **网络 → 接口 → WAN**：

- 协议：DHCP 客户端
- 高级设置：关闭「使用默认网关」（由光猫提供）

### WAN6 配置（获取 IPv6 前缀）

进入 **网络 → 接口 → WAN6**：

- 协议：DHCPv6 客户端
- 请求 IPv6 地址：try
- 请求 IPv6 前缀：auto
- 重启不发送 Release：勾选
- 高级设置：关闭「使用默认网关」

### LAN 口配置（关键避坑）

进入 **网络 → 接口 → LAN**：

### 基本设置

- 协议：静态地址
- IPv4 地址：`192.168.2.1`
- 子网掩码：`255.255.255.0`
- IPv4 网关：`192.168.1.1`（光猫地址）
- DNS：按需填写（如果要自定义 DNS 或者配置过滤）

### 高级设置

- IPv6 ULA 前缀：**清空**（只用公网 IPv6）
- 桥接接口：关闭

### DHCP 服务器 → IPv6 设置

| 配置项             | 推荐值     |
| ------------------ | ---------- |
| 路由通告服务（RA） | 服务器模式 |
| DHCPv6 服务        | 服务器模式 |
| NDP 代理           | 已禁用     |
| ULA 前缀           | 清空       |

> **为什么用服务器模式？** 旧教程推荐的「中继模式」在 90% 的家庭光猫中不兼容，因为大多数光猫不支持跨设备中继 DHCPv6/RA。服务器模式下，AX3000T 直接分配公网 IPv6 地址，稳定性更高。

## 执行配置

下面脚本在服务器终端执行：

```bash
# 1. 清除可能残留的旧中继配置
uci delete dhcp.lan.ra 2>/dev/null
uci delete dhcp.lan.dhcpv6 2>/dev/null
uci delete dhcp.lan.ndp 2>/dev/null
uci delete dhcp.lan.master 2>/dev/null
uci delete dhcp.lan.ula_prefix 2>/dev/null

# 2. 配置 LAN 为 IPv6 服务器模式
uci set dhcp.lan.ra='server'
uci set dhcp.lan.dhcpv6='server'
uci set dhcp.lan.ndp='disabled'
uci set dhcp.lan.ra_management='1'

# 3. 配置 WAN6 获取公网前缀
uci set network.wan6.proto='dhcpv6'
uci set network.wan6.reqaddress='try'
uci set network.wan6.reqprefix='56'
uci set network.wan6.norelease='1'

# 4. 提交并重启
uci commit dhcp
uci commit network
/etc/init.d/network restart
/etc/init.d/odhcpd restart
```

### 验证 IPv6 获取

```powershell
# Windows PowerShell
ipconfig /all

# 应看到类似输出：
# IPv6 地址 . . . . . . . . . . . . : 240e:38a:....
# 临时 IPv6 地址. . . . . . . . . . : 240e:38a:....
# 默认网关. . . . . . . . . . . . . : fe80::ced8:....
```

```powershell
# 测试 IPv6 DNS 连通性
ping -6 2400:3200::1

# 追踪路由
tracert -6 2400:3200::1

# 测试 HTTPS 访问
curl -6 https://www.baidu.com
```

**tracert 结果解读**：

| 跃点      | 结果     | 说明                      |
| --------- | -------- | ------------------------- |
| 第 1 跳   | 1ms 通   | OpenWRT IPv6 转发正常 ✅  |
| 第 2-4 跳 | 超时     | 运营商屏蔽 ICMPv6（正常） |
| 第 5+ 跳  | 正常响应 | IPv6 链路通畅 ✅          |

### 官方测试网站

访问 [test-ipv6.com](https://test-ipv6.com/)：

- 关闭 VPN/代理
- 评分 ≥9/10 = IPv6 完全可用
- 评分 <7/10 = 配置有问题

> **240e 开头** = 即为公网 IPv6

## 公网访问

为了发挥出 IPV6 最大的优势，就是免费公网 IP！

### 配置

首先进入 **网络 → 防火墙**，并配置下面设置：

1. 常规设置
   转发 -- 允许 （让内网 IP 能通过路由器访问，否则即便获取到公网 IP 也是访问不到的）

   :::important
   务必确认自己的防火墙配置已经完善，不要让自己设备的所有端口都裸奔！（特别是 Windows 那一大堆程序）该设密码的地方都已经设好！
   :::

2. 区域设置

   | 区域 | 绑定的网络 | 转发 |
   | ---- | ---------- | ---- |
   | wan  | wan, wan6  | 接受 |

### DDNS

因为公网 IP 基本都是运营商动态分配的， SSL 证书， 建站什么的都需要配置动态域名。

如果是给 OpenWRT 配置，在 **服务 -> DDNS-GO** 中按照步骤配置即可。

如果是给自己的 NAS 或者 Windows 配置，可以配合 <https://github.com/jeessy2/ddns-go> 实现自动化。

现在在自己的绿联 NAS 装了个 Caddy Server 给跑在上面的服务做反向代理，到时候愿意折腾甚至可以跑个 Dokploy, Coolify 或者 1Panel 玩玩，最近还是太累了啊
