---
title: OpenWRT旁路由IPV6解决方案【更新】
published: 2026-02-06
description: 针对 OpenWRT 的旁路由 IPv6 配置方案，包含公网访问、防火墙配置、常见问题排查。
tags: [OpenWRT, AX3000T, IPv6, 路由器]
category: 网络
draft: false
---

## 前言

之前配置的 OpenWRT 重置配置过后就又连不上 IPV6 了，又看了一遍自己写的笔记发现能获取到 IPV6，但是 ping 任何网站都显示为超时...

之前折腾了好一会，最后还是问 <ruby>双子座<rp><rt>Gemini</rt></rp></ruby> (之前玩谷歌娘机翻看到的)

## 网络拓扑

```text
光猫 (192.168.1.1) [主路由，DHCPv4+DHCPv6下发]
       │
       │ WAN 口
       ▼
AX3000T OpenWRT (192.168.1.254 / 192.168.2.1) [旁路由]
       │
       │ LAN 口
       ▼
    客户端
```

## 网络配置

### WAN 口配置（获取 IPv4）

进入 **网络 → 接口 → WAN**：

- 协议：DHCP 客户端
- 高级设置：关闭「使用默认网关」（由光猫提供）

### WAN6 配置（获取 IPv6 前缀）

进入 **网络 → 接口 → WAN6**：

- 协议：DHCPv6 客户端
- 请求 IPv6 地址：try
- 请求 IPv6 前缀：auto
- 重启不发送 Release：勾选
- 高级设置：关闭「使用默认网关」

### LAN 口配置（关键避坑）

进入 **网络 → 接口 → LAN**：

### 基本设置

- 协议：静态地址
- IPv4 地址：`192.168.2.1`
- 子网掩码：`255.255.255.0`
- IPv4 网关：`192.168.1.1`（光猫地址）
- DNS：按需填写（如果要自定义 DNS 或者配置过滤）

### 高级设置

- IPv6 ULA 前缀：**清空**（只用公网 IPv6）
- 桥接接口：关闭

### DHCP 服务器 → IPv6 设置

| 配置项             | 推荐值     |
| ------------------ | ---------- |
| 路由通告服务（RA） | 服务器模式 |
| DHCPv6 服务        | 服务器模式 |
| NDP 代理           | 已禁用     |
| ULA 前缀           | 清空       |

> **为什么用服务器模式？** 旧教程推荐的「中继模式」在 90% 的家庭光猫中不兼容，因为大多数光猫不支持跨设备中继 DHCPv6/RA。服务器模式下，AX3000T 直接分配公网 IPv6 地址，稳定性更高。

## 执行配置

下面脚本在服务器终端执行：

```bash
# 1. 清除可能残留的旧中继配置
uci delete dhcp.lan.ra 2>/dev/null
uci delete dhcp.lan.dhcpv6 2>/dev/null
uci delete dhcp.lan.ndp 2>/dev/null
uci delete dhcp.lan.master 2>/dev/null
uci delete dhcp.lan.ula_prefix 2>/dev/null

# 2. 配置 LAN 为 IPv6 服务器模式
uci set dhcp.lan.ra='server'
uci set dhcp.lan.dhcpv6='server'
uci set dhcp.lan.ndp='disabled'
uci set dhcp.lan.ra_management='1'

# 3. 配置 WAN6 获取公网前缀
uci set network.wan6.proto='dhcpv6'
uci set network.wan6.reqaddress='try'
uci set network.wan6.reqprefix='56'
uci set network.wan6.norelease='1'

# 4. 提交并重启
uci commit dhcp
uci commit network
/etc/init.d/network restart
/etc/init.d/odhcpd restart
```

### 验证 IPv6 获取

```powershell
# Windows PowerShell
ipconfig /all

# 应看到类似输出：
# IPv6 地址 . . . . . . . . . . . . : 240e:38a:....
# 临时 IPv6 地址. . . . . . . . . . : 240e:38a:....
# 默认网关. . . . . . . . . . . . . : fe80::ced8:....
```

```powershell
# 测试 IPv6 DNS 连通性
ping -6 2400:3200::1

# 追踪路由
tracert -6 2400:3200::1

# 测试 HTTPS 访问
curl -6 https://www.baidu.com
```

**tracert 结果解读**：

| 跃点      | 结果     | 说明                      |
| --------- | -------- | ------------------------- |
| 第 1 跳   | 1ms 通   | OpenWRT IPv6 转发正常 ✅  |
| 第 2-4 跳 | 超时     | 运营商屏蔽 ICMPv6（正常） |
| 第 5+ 跳  | 正常响应 | IPv6 公网链路通畅 ✅      |

### 官方测试网站

访问 [test-ipv6.com](https://test-ipv6.com/)：

- 关闭 VPN/代理
- 评分 ≥9/10 = IPv6 完全可用
- 评分 <7/10 = 配置有问题

> **240e 开头** = 即为公网 IPv6

## 公网访问

为了发挥出 IPV6 最大的优势，就是免！费！公！网 IP！

进入 **网络 → 防火墙**：

| 区域 | 绑定的网络 | 转发 |
| ---- | ---------- | ---- |
| lan  | lan        | 接受 |
| wan  | wan, wan6  | 接受 |

不过因为运营商基本都是动态分配公网 IP 的，所以 SSL 什么的都需要配置动态域名，在 **服务 → DDNS-GO** 中按照步骤配置即可，然后就能把自己在家里云部署的服务放在公网上了。

:::important
务必确认自己的防火墙配置已经完善，裸奔有风险，该设密码的地方都已经设了………！

**但公网 IP 也有可能遇到运营商限制，包括但不限于**

- 入站连接受限
- 部分端口可能被运营商封禁
- ...

:::

## 常见问题排查

### 问题 1：第一跳超时

**现象**：`tracert -6` 第一跳就超时

**原因**：旧中继配置残留

**解决**：

```bash
uci delete dhcp.lan.ra
uci delete dhcp.lan.dhcpv6
uci delete dhcp.lan.ndp
uci delete dhcp.lan.master
uci set dhcp.lan.ra='server'
uci set dhcp.lan.dhcpv6='server'
uci commit dhcp
/etc/init.d/odhcpd restart
```

### 问题 2：WAN6 无公网地址

**现象**：WAN6 状态显示「已连接」但无 240e 开头的地址

**原因**：

- 光猫未开启 IPv6
- 光猫未设置为路由模式
- 运营商未分配公网 IPv6

**解决**：

1. 联系运营商开通公网 IPv6
2. 登录光猫，确认 IPv6 已开启
3. 光猫设置为「路由模式」而非「桥接模式」
